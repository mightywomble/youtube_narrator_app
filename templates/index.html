{% extends "base.html" %}

{% block title %}AI Video Narrator - Create Scripts & Narrate{% endblock %}

{% block content %}

<section id="uploadSection">
    <h2>1. Upload Your Video</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="videoFile">Select a video file:</label>
        <input type="file" id="videoFile" name="video" accept="video/*" required>
        <button type="submit" id="uploadVideoBtn">Upload Video & Analyze</button>
        <div id="uploadMessage" class="message"></div>
        <p>
            <em>Note: Video analysis can take a few minutes depending on video length.</em>
        </p>

        <!-- Progress bar for file upload -->
        <div id="uploadProgressBarContainer" class="progress-container hidden">
            <div id="uploadProgressBar" class="progress-bar">0%</div>
            <div id="uploadProgressText" class="progress-text">File Upload: 0%</div>
        </div>

        <!-- Progress bar for video analysis -->
        <div id="analysisProgressBarContainer" class="progress-container hidden">
            <div id="analysisProgressBar" class="progress-bar">0%</div>
            <div id="analysisProgressText" class="progress-text">Analysis: Initializing...</div>
        </div>

    </form>
</section>

<!-- Main display area: Video on left, Script on right (equal halves) -->
<div class="main-display-area">
    <section id="videoPlaybackSection" class="hidden display-box display-half">
        <h2>Original Video Preview</h2>
        <video id="videoPlayer" controls></video>

        <!-- Audio player will sit under the video, within this box -->
        <section id="scriptAudioSection" class="hidden audio-section display-box-inner">
            <h3>Generated Audio</h3>
            <audio id="audioPlayer" controls></audio>
        </section>

        <!-- NEW: Merged Video Preview section, now placed here -->
        <section id="mergeSection" class="hidden display-box-inner">
            <h3>Merged Narrated Video</h3>
            <video id="mergedVideoPlayer" controls></video>
            <div class="button-group">
                <button id="playMergedVideoBtn">Play Merged Video</button>
                <a id="downloadMergedVideoBtn" class="button" download>Download Merged Video</a>
            </div>
            <div id="mergeStatusMessage" class="message"></div>
            <div id="mergeProgressBarContainer" class="progress-container hidden">
                <div id="mergeProgressBar" class="progress-bar">0%</div>
                <div id="mergeProgressText" class="progress-text"></div>
            </div>
        </section>
    </section>

    <!-- Script Section (now side-by-side with video) -->
    <section id="scriptSection" class="hidden display-box display-half">
        <h2>2. Generated Script</h2>
        <label for="scriptText">Review and edit the generated script:</label>
        <textarea id="scriptTextarea" rows="10" placeholder="Script will appear here after video analysis..."></textarea>
        <div id="speechMessage" class="message"></div>

        <!-- Button for Convert Script to Speech, centered below text area -->
        <div class="button-center-wrapper">
            <button id="generateSpeechBtn" disabled>Convert Script to Speech</button>
            <!-- NEW: Create Narrated Video button -->
            <button id="createNarratedVideoBtn" class="green-button" disabled>Create Narrated Video</button>
        </div>
    </section>
</div>

<!-- The old mergeSection is now integrated, so this is removed -->
<!-- <section id="mergeSection" class="hidden display-box slide-in-section"> ... </section> -->

<section id="youtubeUploadDetailsSection" class="hidden youtube-upload-section">
    <h2>4. Upload to YouTube</h2>
    <label for="youtubeTitle">Video Title:</label>
    <input type="text" id="youtubeTitle" placeholder="Enter video title..." required>

    <label for="youtubeDescription">Video Description:</label>
    <textarea id="youtubeDescription" rows="5" placeholder="Enter video description..."></textarea>

    <button id="youtubeUploadBtn" disabled>Upload to YouTube</button>
    <div id="youtubeProgressBarContainer" class="progress-container hidden">
        <div id="youtubeProgressBar" class="progress-bar">0%</div>
        <div id="youtubeProgressText" class="progress-text"></div>
    </div>
    <p>
        <em>Note: For a real YouTube upload, you will need to configure YouTube API credentials in the settings.</em>
    </p>
</section>
{% endblock %}
